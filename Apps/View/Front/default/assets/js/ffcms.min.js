var audioCtx=new(window.AudioContext||window.webkitAudioContext||window.audioContext),beep=function(e,t,a,n,i){var r=audioCtx.createOscillator(),o=audioCtx.createGain();r.connect(o),o.connect(audioCtx.destination),a&&(o.gain.value=a),t&&(r.frequency.value=t),n&&(r.type=n),i&&(r.onended=i),r.start(),setTimeout(function(){r.stop()},e||500)},setNotificationNumber=function(e){if(!isNaN(e)){var t=/^\@\(\d*\+?\)-> /;e<1?document.title=document.title.replace(t,""):t.exec(document.title)?document.title=document.title.replace(t,"@("+e+")-> "):document.title="@("+e+")-> "+document.title}};$(document).ready(function(){function e(){$.getJSON(script_url+"/api/profile/notifications?lang="+script_lang,function(e){1===e.status?(e.summary>0?(n||(beep(150,150,.6,"triangle"),n=!0),i.addClass("alert-danger",1e3).text(e.summary),e.messages>0?r.text(e.messages).addClass("alert-danger",1e3):r.removeClass("alert-danger",1e3).text(0),e.notify>0?o.text(e.notify).addClass("alert-danger",1e3):o.removeClass("alert-danger",1e3).text(0)):i.removeClass("alert-danger",1e3).text(0),setNotificationNumber(e.summary)):!1!==a&&clearInterval(a)}).fail(function(){!1!==a&&clearInterval(a)})}function t(){var e=$("#search-line").val();if(e.length<2)return null;$("#ajax-result-items").empty(),$.getJSON(script_url+"/api/search/index?query="+e+"&lang="+script_lang,function(e){if(!(1!==e.status||e.count<1)){var t=$("#ajax-carcase-item").clone().removeClass("hidden");$.each(e.data,function(e,a){var n=t.clone();n.find("#ajax-search-link").attr("href",site_url+a.uri),n.find("#ajax-search-title").text(a.title),n.find("#ajax-search-snippet").text(a.snippet),$("#ajax-result-items").append(n.html()),n=null}),$("#ajax-result-container").removeClass("hidden")}})}var a=!1,n=!1,i=$("#summary-count-block"),r=$("#pm-count-block"),o=$("#notify-count-block");e(),a=setInterval(e,1e4);var s=0;$("#search-line").keypress(function(e){27!==(void 0!==e.keyCode&&e.keyCode?e.keyCode:e.which)?(s&&clearTimeout(s),s=setTimeout(t,1e3)):$("#ajax-result-container").addClass("hidden")}),$("#search-line").keydown(function(e){("key"in(e=e||window.event)?"Escape"==e.key||"Esc"==e.key:27==e.keyCode)&&($("#ajax-result-container").addClass("hidden"),$(this).val(""))})});